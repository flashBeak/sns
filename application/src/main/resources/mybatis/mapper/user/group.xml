<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="GroupDAO">

	<select id="selectList" resultType="com.model.group.GroupVO">
 		SELECT *
		FROM `group`
		ORDER BY id DESC
	</select>

	<select id="selectListTotalCount" resultType="int">
 		SELECT
			COUNT(*) AS count
		FROM `group`
	</select>

	<select id="selectListByUserId" resultType="com.model.group.GroupVO">
 		SELECT g.*
		FROM `group` g
		JOIN group_member gm ON gm.group_id = g.id
		WHERE gm.user_id = #{userId}
		ORDER BY g.id DESC
	</select>

	<select id="selectListTotalCountByUserId" resultType="int">
 		SELECT
			COUNT(*) AS count
		FROM `group`
		WHERE gm.user_id = #{userId}
	</select>

	<select id="select" parameterType="int" resultType="com.model.group.GroupVO">
		SELECT *
		FROM `group`
		WHERE id = #{id}
	</select>

	<insert id="insert" parameterType="com.model.group.GroupVO">
		INSERT INTO `group` (
			name, address, approve_yn
		<if test="addressDetail != null and addressDetail != ''">
			, address_detail
		</if>
		<if test="introduce != null and introduce != ''">
			, introduce
		</if>
		<if test="etc != null and etc != ''">
			, etc
		</if>
		<if test="lon != null and lon != ''">
			, lon
		</if>
		<if test="lat != null and lat != ''">
			, lat
		</if>
		<if test="phone != null and phone != ''">
			, phone
		</if>
		<if test="representImage != null and representImage != ''">
			, represent_image
		</if>
		<if test="backgroundImage != null and backgroundImage != ''">
			, background_image
		</if>
		) VALUES (
			#{name}, #{address}, #{approveYn}
		<if test="addressDetail != null and addressDetail != ''">
			, #{addressDetail}
		</if>
		<if test="introduce != null and introduce != ''">
			, #{introduce}
		</if>
		<if test="etc != null and etc != ''">
			, #{etc}
		</if>
		<if test="lon != null and lon != ''">
			, #{lon}
		</if>
		<if test="lat != null and lat != ''">
			, #{lat}
		</if>
		<if test="phone != null and phone != ''">
			, #{phone}
		</if>
		<if test="representImage != null and representImage != ''">
			, #{representImage}
		</if>
		<if test="backgroundImage != null and backgroundImage != ''">
			, #{backgroundImage}
		</if>
		)
			
		<selectKey keyProperty="id" resultType="int">
        	SELECT LAST_INSERT_ID()
  		</selectKey>
	</insert>
	
	<update id="update" parameterType="com.model.group.GroupVO">
		UPDATE `group` SET
			id = #{id}
		<if test="name != null and name != ''">
			, name = #{name}
		</if>
		<if test="address != null and address != ''">
			, address = #{address}
		</if>
		<if test="approveYn != null and approveYn != ''">
			, approveYn = #{approveYn}
		</if>
		<if test="addressDetail != null and addressDetail != ''">
			, address_detail = #{addressDetail}
		</if>
		<if test="introduce != null and introduce != ''">
			, introduce = #{introduce}
		</if>
		<if test="etc != null and etc != ''">
			, etc = #{etc}
		</if>
		<if test="lon != null and lon != ''">
			, lon = #{lon}
		</if>
		<if test="lat != null and lat != ''">
			, lat = #{lat}
		</if>
		<if test="phone != null and phone != ''">
			, phone = #{phone}
		</if>
		<if test="representImage != null and representImage != ''">
			, represent_image = #{representImage}
		</if>
		<if test="backgroundImage != null and backgroundImage != ''">
			, background_image = #{backgroundImage}
		</if>
		WHERE id = #{id}
	</update>

	<update id="delete" parameterType="int">
		DELETE FROM `group`
		WHERE id = #{id}
	</update>

	<select id="selectMemberByUserId" parameterType="java.util.Map" resultType="com.model.group.GroupMemberVO">
		SELECT *
		FROM group_member
		WHERE group_id = #{id}
			AND user_id = #{userId}
	</select>

	<insert id="insertMember" parameterType="com.model.group.GroupMemberVO">
		INSERT INTO group_member (
			user_id, group_id
		) VALUES (
			#{userId}, #{groupId}
		)
			
		<selectKey keyProperty="id" resultType="int">
        	SELECT LAST_INSERT_ID()
  		</selectKey>
	</insert>

	<select id="selectManager" parameterType="int" resultType="com.model.group.GroupManagerVO">
		SELECT *
		FROM group_manager
		WHERE group_member_id = #{groupMemberId}
	</select>

	<insert id="insertManager" parameterType="com.model.group.GroupManagerVO">
		INSERT INTO group_manager (
			type, group_id, group_member_id
		<if test="updateYn != null and updateYn != ''">
			, update_yn
		</if>
		<if test="removeYn != null and removeYn != ''">
			, remove_yn
		</if>
		) VALUES (
			#{type}, #{groupId}, #{groupMemberId}
		<if test="updateYn != null and updateYn != ''">
			, #{updateYn}
		</if>
		<if test="removeYn != null and removeYn != ''">
			, #{removeYn}
		</if>
		)
			
		<selectKey keyProperty="id" resultType="int">
        	SELECT LAST_INSERT_ID()
  		</selectKey>
	</insert>
</mapper>